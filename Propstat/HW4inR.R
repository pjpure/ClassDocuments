setwd("~/CE2D-2/git/Propstat")

df <- read.csv("imdbm.csv")

income <- df$income
avg_vote <- df$avg_vote

mean(avg_vote)
sd(avg_vote)

nSample = 50
sampleAvg = sample(avg_vote,nSample)
sampleMean = mean(sampleAvg)
sampleSD = sd(sampleAvg)

getCI <- function(cl,n,x){
  m <- mean(x)  # mean 
  s <- sd(x)  # standard deviation
  
  # 1.standard error (SE)
  se <- s / sqrt(n)
  # 2.z-score
  z <- qnorm(cl) 
  # 3.margin error
  me <- se * z
  # 4.confidence interval
  ci <- c(m - me, m + me)
  return(ci)
}

lowerOf90 = c()
upperOf90 = c()
meanOf90 = c()

for (i in 1:nSample) {
  lowerOf90[i] = getCI(0.90,i,sampleAvg[1:i])[1]
  upperOf90[i] = getCI(0.90,i,sampleAvg[1:i])[2]
  meanOf90[i] = mean(sampleAvg[1:i])
}

nSampleArr = c(1:nSample)
d90 = data.frame(nSample,meanOf90,lowerOf90,upperOf90)

library(ggplot2)

qplot(x    = meanOf90 ,
      y    = nSampleArr,
      color = nSampleArr,
      data = d90,main = "Confidence Interval (CI) of Mean : ??????????????????????????????????????????????????????????????????????????????",xlab = "?????????????????????????????????????????????(???????????????)",
      ylab = "???????????????????????????????????????(??????????????????)") + 
  
  geom_errorbar(aes(
    xmin  = lowerOf90,
    xmax  = upperOf90,
    width = 1))+ geom_vline(xintercept = mean(avg_vote))
  


cl = c(0.9,0.95,0.99)
d = data.frame(
  CL = c("0.9","0.95","0.99"),
  Mean = c(sampleMean,sampleMean,sampleMean),
  lower = c(getCI(cl[1],50,sampleAvg)[1],getCI(cl[2],50,sampleAvg)[1],getCI(cl[3],50,sampleAvg)[1]),
  upper = c(getCI(cl[1],50,sampleAvg)[2],getCI(cl[2],50,sampleAvg)[2],getCI(cl[3],50,sampleAvg)[2])
)

qplot(x    = Mean ,
      y    = CL,
      color = CL,
      data = d,main = "Confidence Interval (CI) of Mean : ??????????????????????????????????????????????????????????????????????????????",xlab = "?????????????????????????????????????????????(???????????????)",
      ylab = "Confidence Level (CL)") + 
  
  geom_errorbar(aes(
    xmin  = lower,
    xmax  = upper,
    width = 0.2))+ geom_vline(xintercept = mean(avg_vote))




