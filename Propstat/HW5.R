setwd("~/CE2D-2/git/Propstat")
library(ggplot2)
library(tidyverse)
library(broom)
library(psych)
library(modelr)
library(ggfortify)
df <- read.csv("imdbm.csv")
View(df)

income <- df$income
avg_vote <- df$avg_vote

xname="?????????????????????????????????????????????(???????????????)"
yname="????????????????????????????????????????????????(????????????????????????????????????????????????)"
relation = lm(income~avg_vote)
relation
summary(relation)

plot(avg_vote,income,abline(lm(income~avg_vote)))


ggplot(df,aes(x=avg_vote,y=income))+geom_point()+
  geom_smooth(method="lm",se=F, size = 1, alpha = 1)+
  xlab("?????????????????????????????????????????????(???????????????)")+
  ylab("????????????????????????????????????????????????(????????????????????????????????????????????????)")+
  theme(axis.title = element_text(size = 20))

ggplot(df,aes(x=avg_vote,y=income))+geom_point()+
  geom_smooth(method="gam",se=F, size = 1, alpha = 1)+
  xlab("?????????????????????????????????????????????(???????????????)")+
  ylab("????????????????????????????????????????????????(????????????????????????????????????????????????)")+
  theme(axis.title = element_text(size = 20))


plot(avg_vote,income,
     xlim=c(0,10),
     xlab = "?????????????????????????????????????????????(???????????????)",
     ylab = "????????????????????????????????????????????????(????????????????????????????????????????????????)",
     main = "????????????????????????????????????????????? & ????????????????????????????????????????????????",
     las = 1,
     cex.lab=1.5,  cex.main=1.5
)


outliers <- function(x) {
  Q1 <- quantile(x, probs=.25)
  Q3 <- quantile(x, probs=.75)
  iqr = Q3-Q1
  upper_limit = Q3 + (iqr*1.5)
  lower_limit = Q1 - (iqr*1.5)
  x > upper_limit | x < lower_limit
}
remove_outliers <- function(df, cols = names(df)) {
  for (col in cols) {
    df <- df[!outliers(df[[col]]),]
  }
  df
}

library(tidyverse)
library(datasets)
library(dplyr)




new_df = remove_outliers(df, c('avg_vote'))

income <- new_df$income
avg_vote <- new_df$avg_vote

model <- lm(income ~ avg_vote,data = new_df)
summary(model)

ggplot(new_df,aes(x=avg_vote,y=income))+geom_point()+
  geom_smooth(method="lm",se=F, size = 1, alpha = 1)+
  xlab(xname)+
  ylab(yname)+
  theme(axis.title = element_text(size = 20))


x=avg_vote
y=income
xbar <- mean(x)
ybar <- mean (y)
n <- length(y)

SSxy <- sum(x*y) - n*xbar*ybar; SSxy
SSxx <- sum (x^2) - n*xbar^2;SSxx
SSyy <- sum(y^2) - n*ybar^2;SSyy
r <- SSxy/(sqrt(SSxx)*sqrt(SSyy));r


df_genre = new_df %>%
  filter(grepl('Action',genre))
income <- df_genre$income
avg_vote <- df_genre$avg_vote

model <- lm(income ~ avg_vote,data = df_genre)
summary(model)



relation = lm(income~avg_vote)
relation
summary(relation)

ggplot(df_genre,aes(x=avg_vote,y=income))+geom_point()+
  geom_smooth(method="lm",se=F, size = 1, alpha = 1)+
  xlab(xname)+
  ylab(yname)+
  theme(axis.title = element_text(size = 20))

x=avg_vote
y=income
xbar <- mean(x)
ybar <- mean (y)
n <- length(y)

SSxy <- sum(x*y) - n*xbar*ybar; SSxy
SSxx <- sum (x^2) - n*xbar^2;SSxx
SSyy <- sum(y^2) - n*ybar^2;SSyy
r <- SSxy/(sqrt(SSxx)*sqrt(SSyy));r




